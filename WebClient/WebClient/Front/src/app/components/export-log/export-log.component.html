<div class="container-fluid">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="h3 mb-1">Log Export</h2>
          <p class="text-muted mb-0">Istoric și detalii despre toate exporturile efectuate</p>
        </div>
        <div>
          <button class="btn btn-outline-secondary btn-modern me-2" (click)="clearLogs()">
            <i class="bi bi-trash me-2"></i>
            Șterge Log-uri
          </button>
          <button class="btn btn-primary-modern btn-modern" (click)="exportLogs()">
            <i class="bi bi-download me-2"></i>
            Exportă Log-uri
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="dashboard-card">
        <div class="position-relative">
          <i class="bi bi-list-check dashboard-card-icon text-primary"></i>
          <div>
            <h4 class="dashboard-card-value text-primary">{{ totalExports }}</h4>
            <p class="dashboard-card-label">Total Exporturi</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="dashboard-card">
        <div class="position-relative">
          <i class="bi bi-check-circle dashboard-card-icon text-success"></i>
          <div>
            <h4 class="dashboard-card-value text-success">{{ successfulExports }}</h4>
            <p class="dashboard-card-label">Exporturi Reușite</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="dashboard-card">
        <div class="position-relative">
          <i class="bi bi-exclamation-triangle dashboard-card-icon text-warning"></i>
          <div>
            <h4 class="dashboard-card-value text-warning">{{ failedExports }}</h4>
            <p class="dashboard-card-label">Exporturi Eșuate</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="dashboard-card">
        <div class="position-relative">
          <i class="bi bi-percent dashboard-card-icon text-info"></i>
          <div>
            <h4 class="dashboard-card-value text-info">{{ getSuccessRate() }}%</h4>
            <p class="dashboard-card-label">Rată Succes</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Export Jobs -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="modern-card">
        <div class="card-header-modern">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title-modern">
              <i class="bi bi-clock-history me-2"></i>
              Istoric Exporturi
            </h5>
            <div class="d-flex gap-2">
              <select class="form-select form-select-sm" [(ngModel)]="selectedStatus" (change)="filterJobs()">
                <option value="">Toate statusurile</option>
                <option value="completed">Finalizate</option>
                <option value="failed">Eșuate</option>
                <option value="processing">În progres</option>
              </select>
              <select class="form-select form-select-sm" [(ngModel)]="selectedMarketplace" (change)="filterJobs()">
                <option value="">Toate marketplace-urile</option>
                <option *ngFor="let marketplace of marketplaces" [value]="marketplace">{{ marketplace }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card-body-modern">
          <div class="table-responsive">
            <table class="table table-modern">
              <thead>
                <tr>
                  <th>Export ID</th>
                  <th>Marketplace</th>
                  <th>Data/Ora</th>
                  <th>Produse</th>
                  <th>Status</th>
                  <th>Progres</th>
                  <th width="120">Acțiuni</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let job of filteredExportJobs">
                  <td>
                    <span class="fw-semibold">#{{ job.id }}</span>
                    <div class="small text-muted">{{ job.name }}</div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="bi bi-shop me-2 text-primary"></i>
                      {{ job.marketplace }}
                    </div>
                  </td>
                  <td>
                    <div>{{ job.startTime | date:'dd/MM/yyyy' }}</div>
                    <div class="small text-muted">{{ job.startTime | date:'HH:mm:ss' }}</div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <span class="fw-semibold me-2">{{ job.totalProducts }}</span>
                      <div class="small">
                        <div class="text-success">✓ {{ job.successfulProducts }}</div>
                        <div class="text-danger" *ngIf="job.failedProducts > 0">✗ {{ job.failedProducts }}</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span [class]="getJobStatusClass(job.status)">
                      {{ getJobStatusLabel(job.status) }}
                    </span>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="progress me-2" style="width: 60px; height: 6px;">
                        <div class="progress-bar" 
                             [class.bg-success]="job.status === 'completed'"
                             [class.bg-danger]="job.status === 'failed'"
                             [class.bg-primary]="job.status === 'processing'"
                             [style.width.%]="job.progress"
                             role="progressbar"></div>
                      </div>
                      <small class="text-muted">{{ job.progress }}%</small>
                    </div>
                  </td>
                  <td>
                    <div class="d-flex gap-1">
                      <button class="btn btn-sm btn-outline-primary" 
                              (click)="viewJobDetails(job)"
                              title="Detalii">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-success" 
                              (click)="downloadExport(job)"
                              title="Descarcă"
                              [disabled]="job.status !== 'completed'">
                        <i class="bi bi-download"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" 
                              (click)="deleteJob(job)"
                              title="Șterge">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Empty state -->
          <div *ngIf="filteredExportJobs.length === 0" class="text-center py-5">
            <i class="bi bi-journal-x display-1 text-muted mb-3"></i>
            <h5 class="text-muted mb-3">Nu există exporturi</h5>
            <p class="text-muted mb-4">Începe primul export pentru a vedea log-urile aici.</p>
            <button class="btn btn-primary-modern btn-modern" routerLink="/product-export">
              <i class="bi bi-plus-circle me-2"></i>
              Creează Export
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Logs -->
  <div class="row" *ngIf="selectedJob">
    <div class="col-12">
      <div class="modern-card">
        <div class="card-header-modern">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title-modern">
              <i class="bi bi-file-text me-2"></i>
              Detalii Export - {{ selectedJob.name }}
            </h5>
            <button class="btn btn-outline-secondary btn-sm" (click)="closeJobDetails()">
              <i class="bi bi-x me-1"></i>
              Închide
            </button>
          </div>
        </div>

        <div class="card-body-modern">
          <!-- Job Summary -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h6 class="text-primary mb-3">Informații Export</h6>
              <div class="table-responsive">
                <table class="table table-sm">
                  <tbody>
                    <tr>
                      <td><strong>ID Export:</strong></td>
                      <td>#{{ selectedJob.id }}</td>
                    </tr>
                    <tr>
                      <td><strong>Nume:</strong></td>
                      <td>{{ selectedJob.name }}</td>
                    </tr>
                    <tr>
                      <td><strong>Marketplace:</strong></td>
                      <td>{{ selectedJob.marketplace }}</td>
                    </tr>
                    <tr>
                      <td><strong>Start:</strong></td>
                      <td>{{ selectedJob.startTime | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                    </tr>
                    <tr>
                      <td><strong>Finalizare:</strong></td>
                      <td>{{ selectedJob.endTime | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                    </tr>
                    <tr>
                      <td><strong>Durată:</strong></td>
                      <td>{{ getDuration(selectedJob.startTime, selectedJob.endTime) }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="col-md-6">
              <h6 class="text-success mb-3">Statistici</h6>
              <div class="row">
                <div class="col-6">
                  <div class="text-center p-3 border rounded">
                    <div class="h4 text-primary">{{ selectedJob.totalProducts }}</div>
                    <small class="text-muted">Total Produse</small>
                  </div>
                </div>
                <div class="col-6">
                  <div class="text-center p-3 border rounded">
                    <div class="h4 text-success">{{ selectedJob.successfulProducts }}</div>
                    <small class="text-muted">Succes</small>
                  </div>
                </div>
                <div class="col-6 mt-2">
                  <div class="text-center p-3 border rounded">
                    <div class="h4 text-danger">{{ selectedJob.failedProducts }}</div>
                    <small class="text-muted">Eșuate</small>
                  </div>
                </div>
                <div class="col-6 mt-2">
                  <div class="text-center p-3 border rounded">
                    <div class="h4 text-info">{{ getJobSuccessRate(selectedJob) }}%</div>
                    <small class="text-muted">Rată Succes</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Log Entries -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">Log Intrări ({{ selectedJob.logEntries?.length || 0 }})</h6>
              <div class="d-flex gap-2">
                <select class="form-select form-select-sm" [(ngModel)]="logTypeFilter" (change)="filterLogEntries()">
                  <option value="">Toate tipurile</option>
                  <option value="success">Succes</option>
                  <option value="error">Erori</option>
                  <option value="warning">Avertismente</option>
                  <option value="info">Informații</option>
                </select>
                <input type="text" 
                       class="form-control form-control-sm" 
                       placeholder="Caută în log..."
                       [(ngModel)]="logSearchTerm"
                       (input)="filterLogEntries()"
                       style="width: 200px;">
              </div>
            </div>
          </div>

          <div class="export-log" style="max-height: 400px; overflow-y: auto;">
            <div *ngFor="let entry of filteredLogEntries" 
                 class="log-item"
                 [class.success]="entry.type === 'success'"
                 [class.error]="entry.type === 'error'"
                 [class.warning]="entry.type === 'warning'"
                 [class.info]="entry.type === 'info'">
              
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center mb-1">
                    <i class="bi" 
                       [class.bi-check-circle-fill]="entry.type === 'success'"
                       [class.bi-x-circle-fill]="entry.type === 'error'"
                       [class.bi-exclamation-triangle-fill]="entry.type === 'warning'"
                       [class.bi-info-circle-fill]="entry.type === 'info'"
                       [class.text-success]="entry.type === 'success'"
                       [class.text-danger]="entry.type === 'error'"
                       [class.text-warning]="entry.type === 'warning'"
                       [class.text-info]="entry.type === 'info'"></i>
                    <strong class="ms-2">{{ entry.productName || entry.action }}</strong>
                  </div>
                  <div class="small text-muted mb-1">{{ entry.message }}</div>
                  <div *ngIf="entry.details" class="small text-muted">
                    <strong>Detalii:</strong> {{ entry.details }}
                  </div>
                </div>
                <div class="text-end">
                  <small class="text-muted">{{ entry.timestamp | date:'HH:mm:ss' }}</small>
                  <div *ngIf="entry.productSku" class="small text-muted">
                    SKU: {{ entry.productSku }}
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Empty log state -->
            <div *ngIf="filteredLogEntries.length === 0" class="text-center py-4">
              <i class="bi bi-search display-4 text-muted"></i>
              <p class="text-muted mt-2">Nu s-au găsit intrări în log cu criteriile selectate</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Analysis -->
  <div class="row" *ngIf="errorAnalysis.length > 0">
    <div class="col-12">
      <div class="modern-card">
        <div class="card-header-modern">
          <h5 class="card-title-modern">
            <i class="bi bi-exclamation-triangle me-2"></i>
            Analiza Erorilor
          </h5>
        </div>
        <div class="card-body-modern">
          <div class="table-responsive">
            <table class="table table-modern">
              <thead>
                <tr>
                  <th>Tip Eroare</th>
                  <th>Frecvență</th>
                  <th>Ultimul Export</th>
                  <th>Acțiuni Recomandate</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let error of errorAnalysis">
                  <td>
                    <span class="fw-semibold">{{ error.type }}</span>
                    <div class="small text-muted">{{ error.description }}</div>
                  </td>
                  <td>
                    <span class="badge bg-danger">{{ error.frequency }}</span>
                  </td>
                  <td>
                    <small class="text-muted">{{ error.lastOccurrence | date:'dd/MM/yyyy HH:mm' }}</small>
                  </td>
                  <td>
                    <div class="small">
                      <div *ngFor="let action of error.recommendedActions" class="mb-1">
                        <i class="bi bi-arrow-right me-1"></i>{{ action }}
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 